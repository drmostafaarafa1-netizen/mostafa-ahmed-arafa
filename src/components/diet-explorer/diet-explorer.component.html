<div class="max-w-5xl mx-auto bg-white p-8 rounded-xl shadow-xl animate-fade-in">
  <h2 class="text-3xl font-bold text-center text-teal-700 mb-2 flex items-center justify-center">
    <i class="fas fa-book-open-reader text-teal-500 ml-3"></i>
    فهم الأنظمة الغذائية بعمق
  </h2>
  <p class="text-center text-gray-600 mb-8">اختر من الأنظمة الغذائية الشائعة أدناه للحصول على تحليل علمي، أو استخدم شريط البحث لطرح سؤالك الخاص.</p>

  <!-- Curated Diets Grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5 mb-10">
    @for (diet of popularDiets; track diet.name) {
      <div class="border border-gray-200 rounded-lg p-5 flex flex-col items-center text-center shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all duration-300 bg-gray-50">
        <div class="text-4xl text-teal-500 mb-3">
          <i [class]="diet.icon"></i>
        </div>
        <h3 class="text-lg font-bold text-gray-800 mb-2">{{ diet.name }}</h3>
        <p class="text-sm text-gray-600 flex-grow mb-4">{{ diet.summary }}</p>
        <button (click)="searchPopular(diet.query)" class="mt-auto w-full px-4 py-2 bg-teal-100 text-teal-800 rounded-full hover:bg-teal-200 transition-colors duration-300 text-sm font-semibold">
          اعرف المزيد
        </button>
      </div>
    }
  </div>

  <div class="flex items-center border-2 border-gray-200 rounded-lg overflow-hidden shadow-sm focus-within:border-teal-500 focus-within:ring-2 focus-within:ring-teal-500/50 transition-all duration-300">
    <input 
      type="text"
      placeholder="أو اكتب سؤالك هنا... مثال: قارن بين الكيتو وحمية البحر الأبيض المتوسط" 
      [(ngModel)]="searchQuery"
      (keyup.enter)="search()"
      class="w-full p-4 border-0 focus:ring-0 text-gray-700"
    >
    <button (click)="search()" [disabled]="isLoading()" class="bg-teal-500 text-white px-8 py-4 hover:bg-teal-600 transition duration-300 disabled:bg-teal-300 shrink-0">
      @if (isLoading()) {
        <i class="fas fa-spinner fa-spin"></i>
      } @else {
        <i class="fas fa-search"></i>
      }
    </button>
  </div>
  
  <div id="search-results">
    @if (error()) {
      <div class="mt-6 p-4 bg-red-100 border-r-4 border-red-500 text-red-700 rounded-lg shadow-sm">
        <p>{{ error() }}</p>
      </div>
    }

    @if (searchResult(); as result) {
      <div class="mt-8 animate-fade-in">
        <h3 class="text-2xl font-bold text-gray-800 mb-4">نتائج البحث عن: "{{ searchQuery() }}"</h3>
        <div class="prose prose-lg max-w-none bg-gray-50 p-6 rounded-lg whitespace-pre-wrap text-gray-700 leading-relaxed border">
          {{ result.text }}
        </div>

        @if (result.sources.length > 0) {
          <div class="mt-6">
            <h4 class="text-xl font-semibold text-gray-700 mb-3 flex items-center"><i class="fas fa-link mr-2 text-gray-400"></i>المصادر الموثوقة:</h4>
            <ul class="space-y-2">
              @for (source of result.sources; track source.web.uri) {
                <li class="flex items-start bg-white border p-3 rounded-md shadow-sm">
                  <i class="fas fa-globe text-teal-500 mt-1"></i>
                  <a [href]="source.web.uri" target="_blank" rel="noopener noreferrer" class="mr-3 text-blue-600 hover:underline hover:text-blue-800 transition duration-300 font-medium">
                    {{ source.web.title || source.web.uri }}
                  </a>
                </li>
              }
            </ul>
          </div>
        }

        <!-- Related Topics Section -->
        @if (relatedTopics().length > 0) {
          <div class="mt-10 pt-6 border-t border-gray-200">
             <h4 class="text-xl font-semibold text-gray-700 mb-4 text-center flex items-center justify-center">
              <i class="fas fa-lightbulb mr-2 text-yellow-400"></i>
              مواضيع قد تهمك أيضاً
             </h4>
             <div class="flex flex-wrap gap-3 justify-center">
              @for (topic of relatedTopics(); track topic) {
                <button (click)="searchPopular(topic)" class="px-4 py-2 bg-gray-100 text-gray-800 rounded-full hover:bg-gray-200 hover:shadow-md transition-all duration-300 text-sm font-semibold border border-gray-300">
                  {{ topic }}
                </button>
              }
             </div>
          </div>
        }
      </div>
    }
  </div>
</div>